# Complete Render Deployment Guide

## üéØ Overview

This guide provides step-by-step instructions for deploying the Lead Nurturing Workflow with AI Agent project on Render. All necessary files have been created and configured for production deployment.

---

## üìã What Has Been Prepared

### ‚úÖ Files Created

1. **Deployment Configuration**
   - `agent_backend/render.yaml` - Infrastructure as Code
   - `agent_backend/build.sh` - Build script
   - `agent_backend/runtime.txt` - Python version
   - `agent_backend/.gitignore` - Git ignore rules
   - `agent_backend/.env.example` - Environment variables template

2. **Settings Configuration**
   - `agent_backend/agent_backend/settings.py` - Production-ready settings
   - Supports environment variables
   - PostgreSQL database support
   - WhiteNoise for static files
   - Security settings for production

3. **RAG Configuration**
   - `ragImplementation/rag_main.py` - Updated for environment variables
   - Supports Render paths
   - Persistent disk support

4. **Documentation**
   - `agent_backend/RENDER_DEPLOYMENT_GUIDE.md` - Comprehensive guide
   - `agent_backend/DEPLOYMENT_CHECKLIST.md` - Deployment checklist
   - `agent_backend/QUICK_START_DEPLOYMENT.md` - Quick start guide
   - `agent_backend/DEPLOYMENT_SUMMARY.md` - Deployment summary
   - `agent_backend/README_DEPLOYMENT.md` - Quick reference

### ‚úÖ Dependencies Added

- `whitenoise==6.7.0` - Static files serving
- `psycopg2-binary==2.9.9` - PostgreSQL adapter
- `dj-database-url==2.1.0` - Database URL parsing
- `gunicorn==21.2.0` - WSGI server

---

## üöÄ Deployment Steps

### Step 1: Prepare Repository (5 minutes)

1. **Verify all files are committed:**
   ```bash
   git status
   git add .
   git commit -m "Prepare for Render deployment"
   ```

2. **Push to GitHub/GitLab/Bitbucket:**
   ```bash
   git push origin main
   ```

3. **Verify files are in repository:**
   - `agent_backend/render.yaml`
   - `agent_backend/build.sh`
   - `agent_backend/requirements.txt`
   - `agent_backend/runtime.txt`

### Step 2: Create Render Account (2 minutes)

1. Go to [render.com](https://render.com)
2. Sign up for a free account
3. Verify your email address
4. (Optional) Add payment method for paid plans

### Step 3: Create PostgreSQL Database (3 minutes)

1. In Render dashboard, click **"New +"** ‚Üí **"PostgreSQL"**
2. Configure the database:
   - **Name**: `lead-nurturing-db`
   - **Database**: `lead_nurturing_db`
   - **User**: `lead_nurturing_user`
   - **Region**: Choose closest to you (e.g., Oregon, Frankfurt)
   - **Plan**: Starter (free tier) or upgrade as needed
3. Click **"Create Database"**
4. **Important**: Note the **Internal Database URL** (you'll need it)

### Step 4: Deploy Web Service (5 minutes)

#### Option A: Using Blueprint (Recommended)

1. In Render dashboard, click **"New +"** ‚Üí **"Blueprint"**
2. Connect your GitHub/GitLab/Bitbucket account
3. Select your repository: `Lead-nurturing-workflow-with-AI-agent`
4. Render will automatically detect `render.yaml`
5. Review the configuration
6. Click **"Apply"**

#### Option B: Manual Setup

1. In Render dashboard, click **"New +"** ‚Üí **"Web Service"**
2. Connect your repository
3. Configure:
   - **Name**: `lead-nurturing-agent`
   - **Environment**: `Python 3`
   - **Region**: Same as database
   - **Branch**: `main` (or your default branch)
   - **Root Directory**: `agent_backend`
   - **Build Command**: `chmod +x build.sh && ./build.sh`
   - **Start Command**: `gunicorn agent_backend.wsgi:application --bind 0.0.0.0:$PORT --workers 2 --timeout 120`

### Step 5: Configure Environment Variables (5 minutes)

Go to your web service ‚Üí **Environment** tab and add:

#### Required Variables

```bash
# Django Settings (Auto-generated by Render)
SECRET_KEY=<auto-generated>
DEBUG=False
RENDER=true

# Database (Auto-set from database)
DATABASE_URL=<auto-set-from-database>

# Email Settings (Set manually)
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-gmail-app-password  # Use Gmail App Password
DEFAULT_FROM_EMAIL=your-email@gmail.com

# Gemini API (Set manually)
GEMINI_API_KEY=your-gemini-api-key-here

# ChromaDB Paths (Already set in render.yaml)
CHROMA_DB_PATH=/opt/render/project/src/ragImplementation/chroma_db
RAG_PDFS_PATH=/opt/render/project/src/ragImplementation/pdfs
```

#### How to Get Gmail App Password

1. Go to your Google Account settings
2. Navigate to **Security** ‚Üí **2-Step Verification**
3. Under **"App passwords"**, create a new app password
4. Save this password (use it for `EMAIL_HOST_PASSWORD`)

#### How to Get Gemini API Key

1. Go to [Google AI Studio](https://makersuite.google.com/app/apikey)
2. Create a new API key
3. Save this key (use it for `GEMINI_API_KEY`)

### Step 6: Configure Persistent Disk (Optional but Recommended)

1. Go to your web service ‚Üí **Settings**
2. Under **"Persistent Disk"**, add a disk:
   - **Name**: `chromadb-disk`
   - **Mount Path**: `/opt/render/project/src/ragImplementation`
   - **Size**: 1GB (minimum)
3. Click **"Save"**

**Note**: This ensures ChromaDB data persists across deployments.

### Step 7: Deploy and Monitor (10 minutes)

1. **Wait for build to complete** (5-10 minutes)
   - Monitor build logs for any errors
   - Check for successful static file collection
   - Verify migrations ran successfully

2. **Check deployment status**:
   - Visit your app URL: `https://your-app.onrender.com`
   - Test API: `https://your-app.onrender.com/api/hello`
   - Should return: `{"message": "Hello from Agent Backend!"}`

### Step 8: Run Migrations (2 minutes)

1. Go to your web service ‚Üí **Shell**
2. Run migrations:
   ```bash
   python manage.py migrate
   ```
3. (Optional) Create superuser:
   ```bash
   python manage.py createsuperuser
   ```

### Step 9: Initialize ChromaDB (Optional, 5 minutes)

1. Go to your web service ‚Üí **Shell**
2. Navigate to ragImplementation:
   ```bash
   cd ../ragImplementation
   ```
3. Build ChromaDB:
   ```bash
   python rag_main.py
   ```
4. **Note**: Make sure PDFs are in the `pdfs` folder first

### Step 10: Verify Deployment (5 minutes)

1. **Test API endpoints:**
   - `/api/hello` - Should return hello message
   - `/api/search?q=test` - Should return RAG search results
   - `/api/leads/filter_leads` - Should return lead filtering

2. **Test Admin panel:**
   - Visit: `https://your-app.onrender.com/admin`
   - Login with superuser credentials

3. **Test static files:**
   - Verify CSS/JS files are loading
   - Check static files are served correctly

4. **Test email:**
   - Send a test email
   - Verify email is received

---

## üîß Configuration Details

### Database Configuration

- **Type**: PostgreSQL
- **Connection**: Internal Database URL (secure)
- **Migrations**: Automatic during build
- **Backups**: Available on paid plans

### Static Files Configuration

- **Server**: WhiteNoise
- **Collection**: Automatic during build
- **Storage**: Compressed Manifest Storage
- **CDN**: Available on Render

### ChromaDB Configuration

- **Storage**: Persistent disk (recommended)
- **Path**: `/opt/render/project/src/ragImplementation/chroma_db`
- **PDFs**: `/opt/render/project/src/ragImplementation/pdfs`
- **Persistence**: Data persists across deployments

### Email Configuration

- **Provider**: Gmail SMTP
- **Authentication**: App Password
- **TLS**: Enabled
- **Port**: 587

---

## üêõ Troubleshooting

### Build Fails

**Problem**: Build fails with errors

**Solution**:
1. Check build logs for specific errors
2. Verify `requirements.txt` includes all dependencies
3. Check Python version matches (3.11.0)
4. Verify `build.sh` is executable

### Database Connection Error

**Problem**: Cannot connect to database

**Solution**:
1. Verify `DATABASE_URL` is set correctly
2. Use **Internal Database URL** (not external)
3. Check database is running
4. Verify database region matches web service region

### Static Files Not Loading

**Problem**: Static files return 404

**Solution**:
1. Verify `collectstatic` ran successfully
2. Check WhiteNoise is installed
3. Verify `STATIC_ROOT` is set correctly
4. Check static files paths in settings

### ChromaDB Path Issues

**Problem**: ChromaDB cannot find path

**Solution**:
1. Verify `CHROMA_DB_PATH` environment variable
2. Check persistent disk is mounted
3. Verify directories are created in `build.sh`
4. Check file permissions

### Email Not Sending

**Problem**: Email sending fails

**Solution**:
1. Verify Gmail App Password is correct
2. Check `EMAIL_HOST_USER` and `EMAIL_HOST_PASSWORD`
3. Ensure 2-Step Verification is enabled
4. Verify email credentials in environment variables

### Application Crashes

**Problem**: Application fails to start

**Solution**:
1. Check logs in Render dashboard
2. Verify all environment variables are set
3. Check `startCommand` is correct
4. Verify port is set to `$PORT`

---

## üìä Monitoring

### Logs

- **Application Logs**: Available in Render dashboard
- **Build Logs**: Available during build
- **Error Logs**: Automatically logged

### Metrics

- **CPU Usage**: Monitor in Render dashboard
- **Memory Usage**: Monitor in Render dashboard
- **Request Count**: Monitor in Render dashboard
- **Response Time**: Monitor in Render dashboard

### Alerts

- **Uptime Monitoring**: Available on Render
- **Error Alerts**: Configure in Render dashboard
- **Resource Alerts**: Configure in Render dashboard

---

## üîí Security

### Environment Variables

- ‚úÖ All secrets stored in environment variables
- ‚úÖ No secrets committed to repository
- ‚úÖ Render environment variables are secure

### Production Settings

- ‚úÖ `DEBUG=False` in production
- ‚úÖ `SECURE_SSL_REDIRECT=True`
- ‚úÖ `SESSION_COOKIE_SECURE=True`
- ‚úÖ `CSRF_COOKIE_SECURE=True`
- ‚úÖ `X_FRAME_OPTIONS='DENY'`

### Database Security

- ‚úÖ PostgreSQL with connection pooling
- ‚úÖ Internal database connection (secure)
- ‚úÖ No hardcoded credentials
- ‚úÖ Connection health checks

---

## üìà Scaling

### Upgrade Plan

1. Go to your web service ‚Üí **Settings**
2. Under **"Plan"**, upgrade to Standard or Pro
3. Benefits:
   - More resources (CPU, RAM)
   - Better performance
   - No spin-down on free tier
   - More database storage

### Add Workers

1. Update `startCommand` in Render:
   ```bash
   gunicorn agent_backend.wsgi:application --bind 0.0.0.0:$PORT --workers 4 --timeout 120
   ```

### Database Upgrade

1. Go to your database ‚Üí **Settings**
2. Upgrade to larger plan
3. Benefits:
   - More storage
   - More connections
   - Better performance

---

## üîÑ Updates

### Update Code

1. Make changes locally
2. Commit and push to repository
3. Render will automatically rebuild and deploy

### Update Dependencies

1. Update `requirements.txt`
2. Commit and push to repository
3. Render will rebuild with new dependencies

### Update Environment Variables

1. Go to Render dashboard ‚Üí Environment
2. Update environment variables
3. Restart service if needed

---

## üìù Maintenance

### Regular Tasks

- ‚úÖ Update dependencies regularly
- ‚úÖ Monitor logs for errors
- ‚úÖ Check resource usage
- ‚úÖ Backup database (paid plans)
- ‚úÖ Update secrets periodically

### Backup Strategy

- ‚úÖ Database backups (paid plans)
- ‚úÖ ChromaDB backups (manual)
- ‚úÖ PDF backups (manual)
- ‚úÖ Environment variable backups

---

## üéâ Success Checklist

- [ ] Application is accessible at Render URL
- [ ] All API endpoints are working
- [ ] Database is connected and migrations are applied
- [ ] Static files are loading correctly
- [ ] Email sending is working
- [ ] RAG search is working
- [ ] T2SQL is working
- [ ] Admin panel is accessible
- [ ] No errors in logs
- [ ] Application is stable

---

## üìö Additional Resources

### Documentation

- **Full Guide**: `agent_backend/RENDER_DEPLOYMENT_GUIDE.md`
- **Checklist**: `agent_backend/DEPLOYMENT_CHECKLIST.md`
- **Quick Start**: `agent_backend/QUICK_START_DEPLOYMENT.md`
- **Summary**: `agent_backend/DEPLOYMENT_SUMMARY.md`
- **Quick Reference**: `agent_backend/README_DEPLOYMENT.md`

### External Resources

- **Render Docs**: https://render.com/docs
- **Django Deployment**: https://docs.djangoproject.com/en/stable/howto/deployment/
- **Render Community**: https://community.render.com
- **Gunicorn Docs**: https://docs.gunicorn.org/

---

## üÜò Support

### Render Support

- **Dashboard**: https://dashboard.render.com
- **Docs**: https://render.com/docs
- **Community**: https://community.render.com
- **Support**: Available on paid plans

### Project Support

- Check deployment guides
- Review troubleshooting section
- Check logs for errors
- Verify configuration

---

## üéØ Next Steps

1. ‚úÖ Deploy to Render
2. ‚úÖ Run migrations
3. ‚úÖ Verify deployment
4. ‚úÖ Test all features
5. ‚úÖ Set up monitoring
6. ‚úÖ Configure backups
7. ‚úÖ Optimize performance
8. ‚úÖ Scale as needed

---

## üöÄ Conclusion

Your application is now ready for deployment on Render! 

All necessary files have been created and configured. Follow the steps above to deploy your application successfully.

**Good luck with your deployment! üéâ**

---

## üìû Need Help?

If you encounter any issues:

1. Check the troubleshooting section
2. Review the deployment guides
3. Check Render logs
4. Verify configuration
5. Contact Render support (paid plans)

---

**Happy Deploying! üöÄ**

